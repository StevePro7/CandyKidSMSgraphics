                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.6.9 #9960 (MINGW64)
                              4 ;--------------------------------------------------------
                              5 	.module screen_manager
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _devkit_SMS_addSprite
                             12 	.globl _devkit_SMS_setTile
                             13 	.globl _devkit_SMS_setNextTileatXY
                             14 	.globl _engine_screen_manager_init
                             15 	.globl _engine_screen_manager_update
                             16 ;--------------------------------------------------------
                             17 ; special function registers
                             18 ;--------------------------------------------------------
                             19 ;--------------------------------------------------------
                             20 ; ram data
                             21 ;--------------------------------------------------------
                             22 	.area _DATA
                             23 ;--------------------------------------------------------
                             24 ; ram data
                             25 ;--------------------------------------------------------
                             26 	.area _INITIALIZED
                             27 ;--------------------------------------------------------
                             28 ; absolute external ram data
                             29 ;--------------------------------------------------------
                             30 	.area _DABS (ABS)
                             31 ;--------------------------------------------------------
                             32 ; global & static initialisations
                             33 ;--------------------------------------------------------
                             34 	.area _HOME
                             35 	.area _GSINIT
                             36 	.area _GSFINAL
                             37 	.area _GSINIT
                             38 ;--------------------------------------------------------
                             39 ; Home
                             40 ;--------------------------------------------------------
                             41 	.area _HOME
                             42 	.area _HOME
                             43 ;--------------------------------------------------------
                             44 ; code
                             45 ;--------------------------------------------------------
                             46 	.area _CODE
                             47 ;screen_manager.c:13: void engine_screen_manager_init()
                             48 ;	---------------------------------
                             49 ; Function engine_screen_manager_init
                             50 ; ---------------------------------
   0000                      51 _engine_screen_manager_init::
                             52 ;screen_manager.c:16: for( x = 2; x < 20; x += 2 )
   0000 06 02         [ 7]   53 	ld	b, #0x02
   0002                      54 00102$:
                             55 ;screen_manager.c:18: draw_tree( x, 2 );
   0002 C5            [11]   56 	push	bc
   0003 3E 02         [ 7]   57 	ld	a, #0x02
   0005 F5            [11]   58 	push	af
   0006 33            [ 6]   59 	inc	sp
   0007 C5            [11]   60 	push	bc
   0008 33            [ 6]   61 	inc	sp
   0009 CDrC8r00      [17]   62 	call	_draw_tree
   000C F1            [10]   63 	pop	af
   000D C1            [10]   64 	pop	bc
                             65 ;screen_manager.c:16: for( x = 2; x < 20; x += 2 )
   000E 04            [ 4]   66 	inc	b
   000F 04            [ 4]   67 	inc	b
   0010 78            [ 4]   68 	ld	a, b
   0011 D6 14         [ 7]   69 	sub	a, #0x14
   0013 38 ED         [12]   70 	jr	C,00102$
   0015 C9            [10]   71 	ret
                             72 ;screen_manager.c:22: void engine_screen_manager_update()
                             73 ;	---------------------------------
                             74 ; Function engine_screen_manager_update
                             75 ; ---------------------------------
   0016                      76 _engine_screen_manager_update::
                             77 ;screen_manager.c:25: draw_sprites( 48, 32, idx + 0 );
   0016 21 20 00      [10]   78 	ld	hl, #0x0020
   0019 E5            [11]   79 	push	hl
   001A 3E 30         [ 7]   80 	ld	a, #0x30
   001C F5            [11]   81 	push	af
   001D 33            [ 6]   82 	inc	sp
   001E CDr32r00      [17]   83 	call	_draw_sprites
                             84 ;screen_manager.c:27: draw_sprites( 128, 32, idx + 0 );
   0021 33            [ 6]   85 	inc	sp
   0022 21 20 00      [10]   86 	ld	hl,#0x0020
   0025 E3            [19]   87 	ex	(sp),hl
   0026 3E 80         [ 7]   88 	ld	a, #0x80
   0028 F5            [11]   89 	push	af
   0029 33            [ 6]   90 	inc	sp
   002A CDr32r00      [17]   91 	call	_draw_sprites
   002D F1            [10]   92 	pop	af
   002E 33            [ 6]   93 	inc	sp
                             94 ;screen_manager.c:40: draw_adriana();
   002F C3r96r00      [10]   95 	jp  _draw_adriana
                             96 ;screen_manager.c:43: static void draw_sprites( unsigned char x, unsigned char y, unsigned char idx )
                             97 ;	---------------------------------
                             98 ; Function draw_sprites
                             99 ; ---------------------------------
   0032                     100 _draw_sprites:
   0032 DD E5         [15]  101 	push	ix
   0034 DD 21 00 00   [14]  102 	ld	ix,#0
   0038 DD 39         [15]  103 	add	ix,sp
   003A F5            [11]  104 	push	af
   003B 3B            [ 6]  105 	dec	sp
                            106 ;screen_manager.c:46: unsigned int tile = 256 + idx * 4;
   003C DD 6E 06      [19]  107 	ld	l, 6 (ix)
   003F 26 00         [ 7]  108 	ld	h, #0x00
   0041 29            [11]  109 	add	hl, hl
   0042 29            [11]  110 	add	hl, hl
   0043 01 00 01      [10]  111 	ld	bc,#0x0100
   0046 09            [11]  112 	add	hl,bc
   0047 E3            [19]  113 	ex	(sp), hl
                            114 ;screen_manager.c:49: for( r = 0; r < 4; r++ )
   0048 1E 00         [ 7]  115 	ld	e, #0x00
                            116 ;screen_manager.c:51: for( c = 0; c < 3; c++ )
   004A                     117 00109$:
   004A 7B            [ 4]  118 	ld	a, e
   004B 07            [ 4]  119 	rlca
   004C 07            [ 4]  120 	rlca
   004D 07            [ 4]  121 	rlca
   004E E6 F8         [ 7]  122 	and	a, #0xf8
   0050 4F            [ 4]  123 	ld	c, a
   0051 DD 7E 05      [19]  124 	ld	a, 5 (ix)
   0054 81            [ 4]  125 	add	a, c
   0055 DD 77 FF      [19]  126 	ld	-1 (ix), a
   0058 16 00         [ 7]  127 	ld	d, #0x00
   005A                     128 00103$:
                            129 ;screen_manager.c:53: unsigned t = r * 4 + c;
   005A 6B            [ 4]  130 	ld	l, e
   005B 26 00         [ 7]  131 	ld	h, #0x00
   005D 29            [11]  132 	add	hl, hl
   005E 29            [11]  133 	add	hl, hl
   005F 4A            [ 4]  134 	ld	c, d
   0060 06 00         [ 7]  135 	ld	b, #0x00
   0062 09            [11]  136 	add	hl, bc
                            137 ;screen_manager.c:54: devkit_SMS_addSprite( x + c * 8 + offset, y + r * 8, tile + t );
   0063 C1            [10]  138 	pop	bc
   0064 C5            [11]  139 	push	bc
   0065 09            [11]  140 	add	hl, bc
   0066 7A            [ 4]  141 	ld	a, d
   0067 07            [ 4]  142 	rlca
   0068 07            [ 4]  143 	rlca
   0069 07            [ 4]  144 	rlca
   006A E6 F8         [ 7]  145 	and	a, #0xf8
   006C 4F            [ 4]  146 	ld	c, a
   006D DD 7E 04      [19]  147 	ld	a, 4 (ix)
   0070 81            [ 4]  148 	add	a, c
   0071 47            [ 4]  149 	ld	b, a
   0072 04            [ 4]  150 	inc	b
   0073 04            [ 4]  151 	inc	b
   0074 04            [ 4]  152 	inc	b
   0075 04            [ 4]  153 	inc	b
   0076 D5            [11]  154 	push	de
   0077 E5            [11]  155 	push	hl
   0078 DD 7E FF      [19]  156 	ld	a, -1 (ix)
   007B F5            [11]  157 	push	af
   007C 33            [ 6]  158 	inc	sp
   007D C5            [11]  159 	push	bc
   007E 33            [ 6]  160 	inc	sp
   007F CDr00r00      [17]  161 	call	_devkit_SMS_addSprite
   0082 F1            [10]  162 	pop	af
   0083 F1            [10]  163 	pop	af
   0084 D1            [10]  164 	pop	de
                            165 ;screen_manager.c:51: for( c = 0; c < 3; c++ )
   0085 14            [ 4]  166 	inc	d
   0086 7A            [ 4]  167 	ld	a, d
   0087 D6 03         [ 7]  168 	sub	a, #0x03
   0089 38 CF         [12]  169 	jr	C,00103$
                            170 ;screen_manager.c:49: for( r = 0; r < 4; r++ )
   008B 1C            [ 4]  171 	inc	e
   008C 7B            [ 4]  172 	ld	a, e
   008D D6 04         [ 7]  173 	sub	a, #0x04
   008F 38 B9         [12]  174 	jr	C,00109$
   0091 DD F9         [10]  175 	ld	sp, ix
   0093 DD E1         [14]  176 	pop	ix
   0095 C9            [10]  177 	ret
                            178 ;screen_manager.c:59: static void draw_adriana()
                            179 ;	---------------------------------
                            180 ; Function draw_adriana
                            181 ; ---------------------------------
   0096                     182 _draw_adriana:
                            183 ;screen_manager.c:65: devkit_SMS_addSprite( x + 0, y + 0, tile + 0 );
   0096 21 40 01      [10]  184 	ld	hl, #0x0140
   0099 E5            [11]  185 	push	hl
   009A 21 B0 20      [10]  186 	ld	hl, #0x20b0
   009D E5            [11]  187 	push	hl
   009E CDr00r00      [17]  188 	call	_devkit_SMS_addSprite
   00A1 F1            [10]  189 	pop	af
                            190 ;screen_manager.c:66: devkit_SMS_addSprite( x + 8, y + 0, tile + 1 );
   00A2 21 41 01      [10]  191 	ld	hl, #0x0141
   00A5 E3            [19]  192 	ex	(sp),hl
   00A6 21 B8 20      [10]  193 	ld	hl, #0x20b8
   00A9 E5            [11]  194 	push	hl
   00AA CDr00r00      [17]  195 	call	_devkit_SMS_addSprite
   00AD F1            [10]  196 	pop	af
                            197 ;screen_manager.c:67: devkit_SMS_addSprite( x + 0, y + 8, tile + 2 );
   00AE 21 42 01      [10]  198 	ld	hl, #0x0142
   00B1 E3            [19]  199 	ex	(sp),hl
   00B2 21 B0 28      [10]  200 	ld	hl, #0x28b0
   00B5 E5            [11]  201 	push	hl
   00B6 CDr00r00      [17]  202 	call	_devkit_SMS_addSprite
   00B9 F1            [10]  203 	pop	af
                            204 ;screen_manager.c:68: devkit_SMS_addSprite( x + 8, y + 8, tile + 3 );
   00BA 21 43 01      [10]  205 	ld	hl, #0x0143
   00BD E3            [19]  206 	ex	(sp),hl
   00BE 21 B8 28      [10]  207 	ld	hl, #0x28b8
   00C1 E5            [11]  208 	push	hl
   00C2 CDr00r00      [17]  209 	call	_devkit_SMS_addSprite
   00C5 F1            [10]  210 	pop	af
   00C6 F1            [10]  211 	pop	af
   00C7 C9            [10]  212 	ret
                            213 ;screen_manager.c:71: static void draw_tree( unsigned char x, unsigned char y )
                            214 ;	---------------------------------
                            215 ; Function draw_tree
                            216 ; ---------------------------------
   00C8                     217 _draw_tree:
   00C8 DD E5         [15]  218 	push	ix
   00CA DD 21 00 00   [14]  219 	ld	ix,#0
   00CE DD 39         [15]  220 	add	ix,sp
                            221 ;screen_manager.c:73: const unsigned int *pnt = ( const unsigned int * )tree_avoid__tilemap__bin;
   00D0 11r00r00      [10]  222 	ld	de, #_tree_avoid__tilemap__bin
                            223 ;screen_manager.c:75: devkit_SMS_setNextTileatXY( x + 0, y + 0 ); 	devkit_SMS_setTile( *pnt + 0 );
   00D3 D5            [11]  224 	push	de
   00D4 DD 66 05      [19]  225 	ld	h, 5 (ix)
   00D7 DD 6E 04      [19]  226 	ld	l, 4 (ix)
   00DA E5            [11]  227 	push	hl
   00DB CDr00r00      [17]  228 	call	_devkit_SMS_setNextTileatXY
   00DE F1            [10]  229 	pop	af
   00DF D1            [10]  230 	pop	de
   00E0 6B            [ 4]  231 	ld	l, e
   00E1 62            [ 4]  232 	ld	h, d
   00E2 46            [ 7]  233 	ld	b, (hl)
   00E3 23            [ 6]  234 	inc	hl
   00E4 4E            [ 7]  235 	ld	c, (hl)
   00E5 D5            [11]  236 	push	de
   00E6 C5            [11]  237 	push	bc
   00E7 33            [ 6]  238 	inc	sp
   00E8 CDr00r00      [17]  239 	call	_devkit_SMS_setTile
   00EB 33            [ 6]  240 	inc	sp
   00EC D1            [10]  241 	pop	de
                            242 ;screen_manager.c:76: devkit_SMS_setNextTileatXY( x + 1, y + 0 ); 	devkit_SMS_setTile( *pnt + 1 );
   00ED DD 4E 04      [19]  243 	ld	c, 4 (ix)
   00F0 0C            [ 4]  244 	inc	c
   00F1 C5            [11]  245 	push	bc
   00F2 D5            [11]  246 	push	de
   00F3 DD 46 05      [19]  247 	ld	b, 5 (ix)
   00F6 C5            [11]  248 	push	bc
   00F7 CDr00r00      [17]  249 	call	_devkit_SMS_setNextTileatXY
   00FA F1            [10]  250 	pop	af
   00FB D1            [10]  251 	pop	de
   00FC C1            [10]  252 	pop	bc
   00FD 6B            [ 4]  253 	ld	l, e
   00FE 62            [ 4]  254 	ld	h, d
   00FF 7E            [ 7]  255 	ld	a, (hl)
   0100 23            [ 6]  256 	inc	hl
   0101 46            [ 7]  257 	ld	b, (hl)
   0102 47            [ 4]  258 	ld	b, a
   0103 04            [ 4]  259 	inc	b
   0104 C5            [11]  260 	push	bc
   0105 D5            [11]  261 	push	de
   0106 C5            [11]  262 	push	bc
   0107 33            [ 6]  263 	inc	sp
   0108 CDr00r00      [17]  264 	call	_devkit_SMS_setTile
   010B 33            [ 6]  265 	inc	sp
   010C D1            [10]  266 	pop	de
   010D C1            [10]  267 	pop	bc
                            268 ;screen_manager.c:77: devkit_SMS_setNextTileatXY( x + 0, y + 1 ); 	devkit_SMS_setTile( *pnt + 2 );
   010E DD 46 05      [19]  269 	ld	b, 5 (ix)
   0111 04            [ 4]  270 	inc	b
   0112 C5            [11]  271 	push	bc
   0113 D5            [11]  272 	push	de
   0114 C5            [11]  273 	push	bc
   0115 33            [ 6]  274 	inc	sp
   0116 DD 7E 04      [19]  275 	ld	a, 4 (ix)
   0119 F5            [11]  276 	push	af
   011A 33            [ 6]  277 	inc	sp
   011B CDr00r00      [17]  278 	call	_devkit_SMS_setNextTileatXY
   011E F1            [10]  279 	pop	af
   011F D1            [10]  280 	pop	de
   0120 C1            [10]  281 	pop	bc
   0121 6B            [ 4]  282 	ld	l, e
   0122 62            [ 4]  283 	ld	h, d
   0123 7E            [ 7]  284 	ld	a, (hl)
   0124 23            [ 6]  285 	inc	hl
   0125 66            [ 7]  286 	ld	h, (hl)
   0126 6F            [ 4]  287 	ld	l, a
   0127 2C            [ 4]  288 	inc	l
   0128 2C            [ 4]  289 	inc	l
   0129 C5            [11]  290 	push	bc
   012A D5            [11]  291 	push	de
   012B 7D            [ 4]  292 	ld	a, l
   012C F5            [11]  293 	push	af
   012D 33            [ 6]  294 	inc	sp
   012E CDr00r00      [17]  295 	call	_devkit_SMS_setTile
   0131 33            [ 6]  296 	inc	sp
   0132 D1            [10]  297 	pop	de
   0133 C1            [10]  298 	pop	bc
                            299 ;screen_manager.c:78: devkit_SMS_setNextTileatXY( x + 1, y + 1 ); 	devkit_SMS_setTile( *pnt + 3 );
   0134 D5            [11]  300 	push	de
   0135 C5            [11]  301 	push	bc
   0136 CDr00r00      [17]  302 	call	_devkit_SMS_setNextTileatXY
   0139 F1            [10]  303 	pop	af
   013A E1            [10]  304 	pop	hl
   013B 4E            [ 7]  305 	ld	c, (hl)
   013C 23            [ 6]  306 	inc	hl
   013D 46            [ 7]  307 	ld	b, (hl)
   013E 41            [ 4]  308 	ld	b, c
   013F 04            [ 4]  309 	inc	b
   0140 04            [ 4]  310 	inc	b
   0141 04            [ 4]  311 	inc	b
   0142 C5            [11]  312 	push	bc
   0143 33            [ 6]  313 	inc	sp
   0144 CDr00r00      [17]  314 	call	_devkit_SMS_setTile
   0147 33            [ 6]  315 	inc	sp
   0148 DD E1         [14]  316 	pop	ix
   014A C9            [10]  317 	ret
                            318 	.area _CODE
                            319 	.area _INITIALIZER
                            320 	.area _CABS (ABS)
